<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605627 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="506"/>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">实现内容</h2>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">task1~task4</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">运行</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">1、  make all<br/>
2、  make run<br/>
3、  loadboot<br/>
4、  输入taskname，以回车结束。<br/>
5、  用户程序执行结束后会自动返回内核，输入新的taskname即可执行新的用户程序。</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">实现细节</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1、task_info的写入和读取</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">1）  createimage首先将task_info写入image文件的末尾，紧挨各用户程序。<br/>
将task_info的相对偏移量写入OS_SIZE_LOC - 4的位置（kernel_size所在位置的前4个字节）。<br/>
将tasknum写入OS_SIZE_LOC - 8的位置（kernel_size所在位置的前8个字节）.<br/>
当第一个扇区被读入后，task_info的偏移量所在地址就是0x502001f8。而tasknum则位于0x502001f4。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    fseek(img, APP_INFO_ADDR, SEEK_SET);
    fwrite(offset, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">4</span>, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>, img);
    
    fseek(img, APP_INFO_ADDR - <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">4</span>, SEEK_SET);
    fwrite(&amp;tasknum, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>, img);
    
    fseek(img, *offset, SEEK_SET);
    fwrite(taskinfo, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">16</span>, tasknum, img);
</code></pre>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">2）  bootblock从0x502001f8读出task_info的偏移量，然后计算出其所在扇区位置。<br/>
并根据tasknum，将task_info所在的1个扇区读入内存中合适位置（位于各用户程序之后）。</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">3）  task_info信息的读取没有选择在kernel中实现，而是将其放在了loader中：<br/>
loader也从0x502001f8读出task_info的偏移量，从0x502001f4读出task_num。<br/>
然后据此计算task_info此时所在的内存地址，然后将其读出。</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">4）  通过比对task_info中各结构体的name域，loader可以在存放某task信息的结构体中读出该task的size和offset。<br/>
loader据此将该task所在扇区读入内存，并计算该task的起始地址，将其作为return值返回给kernel。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">unsigned</span> start_address = mem_address + offset - (sector_start * SECTOR_SIZE);
</code></pre>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">2、crt0.S</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">1）  crt.S文件随各用户程序一起编译，主要实现的功能是清bss段，设置栈指针。在用户程序结束后回收栈帧并跳回内核。<br/>
2）  首先crt0.S也会从0x502001f4读出task_num。然后据此将栈指针设置在各用户程序所在内存地址的后0x20000个字节处。<br/>
3）  不过在设置用户程序的sp之前，crt0会先把kernel的栈指针存在a2寄存器中，以待之后恢复。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    add a2, x0, sp
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">4）  接着crt0.S会call main，从而跳转到kernel的main函数中，读取taskname并执行相应用户程序。<br/>
5）  用户程序return后，回到call main的下一条指令处。具体来说是恢复kernel的栈指针的指令。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    call main
    add sp, x0, a2
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">6）接着跳转回kernel，继续执行。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    la a1, kernel
    jr a1
</code></pre>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">部分所遇问题及调试解决</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1、taskinfo被正确储存及读入内存，但loader没有成功取出。</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">问题原因：为了读取int型的size和offset，在loader中使用的是int型指针。此时+1相当于是+4bytes。<br/>
发现方法：gdb跟踪调试。确认taskinfo起始地址正确后，在改地址出逐个byte核对信息。<br/>
解决方案：将原本的+4、+8改为+1、+2即可。</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">2、将用户程序读入内存后，没有进入入口执行。</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">问题原因：由于用户程序紧密排列，所以尽管将用户程序所在扇区放在了某一确定的内存空间出，但其入口地址还需要配合该用户程序的offset进行计算。</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">发现方法：输入taskname后报错，确认正确读取了taskinfo，仔细思考后发现原因。<br/>
解决方案：在loader中计算出正确的入口地址，作为返回值回传给main函数，再跳转执行。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">mem_address = load_task_img(task_name);
</code></pre>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3、跳转至用户程序</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">使用嵌入式汇编是一个方案，但灵活利用C语言中”指向函数的指针“，可以简洁地实现跳转。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">((void(*)(void))mem_address)();
</code></pre>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">4、个人觉得本实验的难点</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">本实验最难之处在于正确理解各文件之间的关系，以及其所在内存位置，相互之间的调用关系。<br/>
理解上述内容之后，就可以比较灵活地安排需要存储、传递的内容，按照自己的想法实现目标功能。<br/>
否则就会觉得无从下手，不知道该在何处实现何种功能。<br/>
俗话说万事开头难，完成本次试验后，可以说对操作系统的结构又有了一个更清晰的认识（该说是因为以前就没有认识吧：））。</p>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%23%20%E5%AE%9E%E7%8E%B0%E5%86%85%E5%AE%B9%0A%0A*%20*%20*%0A%0Atask1~task4%0A%0A*%20*%20*%0A%0A%23%23%20%E8%BF%90%E8%A1%8C%0A1%E3%80%81%20%20make%20all%0A2%E3%80%81%20%20make%20run%0A3%E3%80%81%20%20loadboot%0A4%E3%80%81%20%20%E8%BE%93%E5%85%A5taskname%EF%BC%8C%E4%BB%A5%E5%9B%9E%E8%BD%A6%E7%BB%93%E6%9D%9F%E3%80%82%0A5%E3%80%81%20%20%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9D%9F%E5%90%8E%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%BF%94%E5%9B%9E%E5%86%85%E6%A0%B8%EF%BC%8C%E8%BE%93%E5%85%A5%E6%96%B0%E7%9A%84taskname%E5%8D%B3%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%B0%E7%9A%84%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E3%80%82%0A%20%20%0A%23%23%20%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82%0A%23%23%23%20%20%20%20%201%E3%80%81task_info%E7%9A%84%E5%86%99%E5%85%A5%E5%92%8C%E8%AF%BB%E5%8F%96%0A1%EF%BC%89%20%20createimage%E9%A6%96%E5%85%88%E5%B0%86task_info%E5%86%99%E5%85%A5image%E6%96%87%E4%BB%B6%E7%9A%84%E6%9C%AB%E5%B0%BE%EF%BC%8C%E7%B4%A7%E6%8C%A8%E5%90%84%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E3%80%82%0A%20%20%20%20%20%20%20%20%E5%B0%86task_info%E7%9A%84%E7%9B%B8%E5%AF%B9%E5%81%8F%E7%A7%BB%E9%87%8F%E5%86%99%E5%85%A5OS_SIZE_LOC%20-%204%E7%9A%84%E4%BD%8D%E7%BD%AE%EF%BC%88kernel_size%E6%89%80%E5%9C%A8%E4%BD%8D%E7%BD%AE%E7%9A%84%E5%89%8D4%E4%B8%AA%E5%AD%97%E8%8A%82%EF%BC%89%E3%80%82%0A%20%20%20%20%20%20%20%20%E5%B0%86tasknum%E5%86%99%E5%85%A5OS_SIZE_LOC%20-%208%E7%9A%84%E4%BD%8D%E7%BD%AE%EF%BC%88kernel_size%E6%89%80%E5%9C%A8%E4%BD%8D%E7%BD%AE%E7%9A%84%E5%89%8D8%E4%B8%AA%E5%AD%97%E8%8A%82%EF%BC%89.%0A%20%20%20%20%20%20%20%20%E5%BD%93%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%89%87%E5%8C%BA%E8%A2%AB%E8%AF%BB%E5%85%A5%E5%90%8E%EF%BC%8Ctask_info%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F%E6%89%80%E5%9C%A8%E5%9C%B0%E5%9D%80%E5%B0%B1%E6%98%AF0x502001f8%E3%80%82%E8%80%8Ctasknum%E5%88%99%E4%BD%8D%E4%BA%8E0x502001f4%E3%80%82%0A%60%60%60%20C%0A%20%20%20%20fseek(img%2C%20APP_INFO_ADDR%2C%20SEEK_SET)%3B%0A%20%20%20%20fwrite(offset%2C%204%2C%201%2C%20img)%3B%0A%20%20%20%20%0A%20%20%20%20fseek(img%2C%20APP_INFO_ADDR%20-%204%2C%20SEEK_SET)%3B%0A%20%20%20%20fwrite(%26tasknum%2C%202%2C%201%2C%20img)%3B%0A%20%20%20%20%0A%20%20%20%20fseek(img%2C%20*offset%2C%20SEEK_SET)%3B%0A%20%20%20%20fwrite(taskinfo%2C%2016%2C%20tasknum%2C%20img)%3B%0A%60%60%60%0A%0A*%20*%20*%0A%0A2%EF%BC%89%20%20bootblock%E4%BB%8E0x502001f8%E8%AF%BB%E5%87%BAtask_info%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AE%A1%E7%AE%97%E5%87%BA%E5%85%B6%E6%89%80%E5%9C%A8%E6%89%87%E5%8C%BA%E4%BD%8D%E7%BD%AE%E3%80%82%0A%20%20%20%20%20%20%20%20%E5%B9%B6%E6%A0%B9%E6%8D%AEtasknum%EF%BC%8C%E5%B0%86task_info%E6%89%80%E5%9C%A8%E7%9A%841%E4%B8%AA%E6%89%87%E5%8C%BA%E8%AF%BB%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%AD%E5%90%88%E9%80%82%E4%BD%8D%E7%BD%AE%EF%BC%88%E4%BD%8D%E4%BA%8E%E5%90%84%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E4%B9%8B%E5%90%8E%EF%BC%89%E3%80%82%0A%0A*%20*%20*%0A%0A3%EF%BC%89%20%20task_info%E4%BF%A1%E6%81%AF%E7%9A%84%E8%AF%BB%E5%8F%96%E6%B2%A1%E6%9C%89%E9%80%89%E6%8B%A9%E5%9C%A8kernel%E4%B8%AD%E5%AE%9E%E7%8E%B0%EF%BC%8C%E8%80%8C%E6%98%AF%E5%B0%86%E5%85%B6%E6%94%BE%E5%9C%A8%E4%BA%86loader%E4%B8%AD%EF%BC%9A%0A%20%20%20%20%20%20%20%20loader%E4%B9%9F%E4%BB%8E0x502001f8%E8%AF%BB%E5%87%BAtask_info%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F%EF%BC%8C%E4%BB%8E0x502001f4%E8%AF%BB%E5%87%BAtask_num%E3%80%82%0A%20%20%20%20%20%20%20%20%E7%84%B6%E5%90%8E%E6%8D%AE%E6%AD%A4%E8%AE%A1%E7%AE%97task_info%E6%AD%A4%E6%97%B6%E6%89%80%E5%9C%A8%E7%9A%84%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%86%E5%85%B6%E8%AF%BB%E5%87%BA%E3%80%82%0A%20%20%20%20%20%20%20%0A*%20*%20*%0A%0A4%EF%BC%89%20%20%E9%80%9A%E8%BF%87%E6%AF%94%E5%AF%B9task_info%E4%B8%AD%E5%90%84%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84name%E5%9F%9F%EF%BC%8Cloader%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%AD%98%E6%94%BE%E6%9F%90task%E4%BF%A1%E6%81%AF%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E8%AF%BB%E5%87%BA%E8%AF%A5task%E7%9A%84size%E5%92%8Coffset%E3%80%82%0A%20%20%20%20%20%20%20%20loader%E6%8D%AE%E6%AD%A4%E5%B0%86%E8%AF%A5task%E6%89%80%E5%9C%A8%E6%89%87%E5%8C%BA%E8%AF%BB%E5%85%A5%E5%86%85%E5%AD%98%EF%BC%8C%E5%B9%B6%E8%AE%A1%E7%AE%97%E8%AF%A5task%E7%9A%84%E8%B5%B7%E5%A7%8B%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%B0%86%E5%85%B6%E4%BD%9C%E4%B8%BAreturn%E5%80%BC%E8%BF%94%E5%9B%9E%E7%BB%99kernel%E3%80%82%0A%20%20%20%20%20%20%20%20%0A%60%60%60%20C%0A%20%20%20%20unsigned%20start_address%20%3D%20mem_address%20%2B%20offset%20-%20(sector_start%20*%20SECTOR_SIZE)%3B%0A%60%60%60%0A%0A*%20*%20*%0A%0A%23%23%23%20%20%20%20%20%202%E3%80%81crt0.S%0A1%EF%BC%89%20%20crt.S%E6%96%87%E4%BB%B6%E9%9A%8F%E5%90%84%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E4%B8%80%E8%B5%B7%E7%BC%96%E8%AF%91%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8A%9F%E8%83%BD%E6%98%AF%E6%B8%85bss%E6%AE%B5%EF%BC%8C%E8%AE%BE%E7%BD%AE%E6%A0%88%E6%8C%87%E9%92%88%E3%80%82%E5%9C%A8%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9D%9F%E5%90%8E%E5%9B%9E%E6%94%B6%E6%A0%88%E5%B8%A7%E5%B9%B6%E8%B7%B3%E5%9B%9E%E5%86%85%E6%A0%B8%E3%80%82%0A2%EF%BC%89%20%20%E9%A6%96%E5%85%88crt0.S%E4%B9%9F%E4%BC%9A%E4%BB%8E0x502001f4%E8%AF%BB%E5%87%BAtask_num%E3%80%82%E7%84%B6%E5%90%8E%E6%8D%AE%E6%AD%A4%E5%B0%86%E6%A0%88%E6%8C%87%E9%92%88%E8%AE%BE%E7%BD%AE%E5%9C%A8%E5%90%84%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E6%89%80%E5%9C%A8%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%E7%9A%84%E5%90%8E0x20000%E4%B8%AA%E5%AD%97%E8%8A%82%E5%A4%84%E3%80%82%0A3%EF%BC%89%20%20%E4%B8%8D%E8%BF%87%E5%9C%A8%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E7%9A%84sp%E4%B9%8B%E5%89%8D%EF%BC%8Ccrt0%E4%BC%9A%E5%85%88%E6%8A%8Akernel%E7%9A%84%E6%A0%88%E6%8C%87%E9%92%88%E5%AD%98%E5%9C%A8a2%E5%AF%84%E5%AD%98%E5%99%A8%E4%B8%AD%EF%BC%8C%E4%BB%A5%E5%BE%85%E4%B9%8B%E5%90%8E%E6%81%A2%E5%A4%8D%E3%80%82%0A%60%60%60%0A%20%20%20%20add%20a2%2C%20x0%2C%20sp%0A%60%60%60%0A4%EF%BC%89%20%20%E6%8E%A5%E7%9D%80crt0.S%E4%BC%9Acall%20main%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%B7%B3%E8%BD%AC%E5%88%B0kernel%E7%9A%84main%E5%87%BD%E6%95%B0%E4%B8%AD%EF%BC%8C%E8%AF%BB%E5%8F%96taskname%E5%B9%B6%E6%89%A7%E8%A1%8C%E7%9B%B8%E5%BA%94%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E3%80%82%0A5%EF%BC%89%20%20%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8Freturn%E5%90%8E%EF%BC%8C%E5%9B%9E%E5%88%B0call%20main%E7%9A%84%E4%B8%8B%E4%B8%80%E6%9D%A1%E6%8C%87%E4%BB%A4%E5%A4%84%E3%80%82%E5%85%B7%E4%BD%93%E6%9D%A5%E8%AF%B4%E6%98%AF%E6%81%A2%E5%A4%8Dkernel%E7%9A%84%E6%A0%88%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E4%BB%A4%E3%80%82%0A%60%60%60%0A%20%20%20%20call%20main%0A%20%20%20%20add%20sp%2C%20x0%2C%20a2%0A%60%60%60%0A6%EF%BC%89%E6%8E%A5%E7%9D%80%E8%B7%B3%E8%BD%AC%E5%9B%9Ekernel%EF%BC%8C%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%E3%80%82%0A%60%60%60%0A%20%20%20%20la%20a1%2C%20kernel%0A%20%20%20%20jr%20a1%0A%60%60%60%0A%0A*%20*%20*%0A%0A%23%23%20%E9%83%A8%E5%88%86%E6%89%80%E9%81%87%E9%97%AE%E9%A2%98%E5%8F%8A%E8%B0%83%E8%AF%95%E8%A7%A3%E5%86%B3%0A%23%23%23%201%E3%80%81taskinfo%E8%A2%AB%E6%AD%A3%E7%A1%AE%E5%82%A8%E5%AD%98%E5%8F%8A%E8%AF%BB%E5%85%A5%E5%86%85%E5%AD%98%EF%BC%8C%E4%BD%86loader%E6%B2%A1%E6%9C%89%E6%88%90%E5%8A%9F%E5%8F%96%E5%87%BA%E3%80%82%0A%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0%EF%BC%9A%E4%B8%BA%E4%BA%86%E8%AF%BB%E5%8F%96int%E5%9E%8B%E7%9A%84size%E5%92%8Coffset%EF%BC%8C%E5%9C%A8loader%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFint%E5%9E%8B%E6%8C%87%E9%92%88%E3%80%82%E6%AD%A4%E6%97%B6%2B1%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%98%AF%2B4bytes%E3%80%82%0A%E5%8F%91%E7%8E%B0%E6%96%B9%E6%B3%95%EF%BC%9Agdb%E8%B7%9F%E8%B8%AA%E8%B0%83%E8%AF%95%E3%80%82%E7%A1%AE%E8%AE%A4taskinfo%E8%B5%B7%E5%A7%8B%E5%9C%B0%E5%9D%80%E6%AD%A3%E7%A1%AE%E5%90%8E%EF%BC%8C%E5%9C%A8%E6%94%B9%E5%9C%B0%E5%9D%80%E5%87%BA%E9%80%90%E4%B8%AAbyte%E6%A0%B8%E5%AF%B9%E4%BF%A1%E6%81%AF%E3%80%82%0A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E5%B0%86%E5%8E%9F%E6%9C%AC%E7%9A%84%2B4%E3%80%81%2B8%E6%94%B9%E4%B8%BA%2B1%E3%80%81%2B2%E5%8D%B3%E5%8F%AF%E3%80%82%0A%23%23%23%202%E3%80%81%E5%B0%86%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E8%AF%BB%E5%85%A5%E5%86%85%E5%AD%98%E5%90%8E%EF%BC%8C%E6%B2%A1%E6%9C%89%E8%BF%9B%E5%85%A5%E5%85%A5%E5%8F%A3%E6%89%A7%E8%A1%8C%E3%80%82%0A%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0%EF%BC%9A%E7%94%B1%E4%BA%8E%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E7%B4%A7%E5%AF%86%E6%8E%92%E5%88%97%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%BD%E7%AE%A1%E5%B0%86%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E6%89%80%E5%9C%A8%E6%89%87%E5%8C%BA%E6%94%BE%E5%9C%A8%E4%BA%86%E6%9F%90%E4%B8%80%E7%A1%AE%E5%AE%9A%E7%9A%84%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%87%BA%EF%BC%8C%E4%BD%86%E5%85%B6%E5%85%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E8%BF%98%E9%9C%80%E8%A6%81%E9%85%8D%E5%90%88%E8%AF%A5%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E7%9A%84offset%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97%E3%80%82%0A%0A*%20*%20*%0A%E5%8F%91%E7%8E%B0%E6%96%B9%E6%B3%95%EF%BC%9A%E8%BE%93%E5%85%A5taskname%E5%90%8E%E6%8A%A5%E9%94%99%EF%BC%8C%E7%A1%AE%E8%AE%A4%E6%AD%A3%E7%A1%AE%E8%AF%BB%E5%8F%96%E4%BA%86taskinfo%EF%BC%8C%E4%BB%94%E7%BB%86%E6%80%9D%E8%80%83%E5%90%8E%E5%8F%91%E7%8E%B0%E5%8E%9F%E5%9B%A0%E3%80%82%0A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E5%9C%A8loader%E4%B8%AD%E8%AE%A1%E7%AE%97%E5%87%BA%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%85%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%EF%BC%8C%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC%E5%9B%9E%E4%BC%A0%E7%BB%99main%E5%87%BD%E6%95%B0%EF%BC%8C%E5%86%8D%E8%B7%B3%E8%BD%AC%E6%89%A7%E8%A1%8C%E3%80%82%0A%60%60%60%0Amem_address%20%3D%20load_task_img(task_name)%3B%0A%60%60%60%0A%0A*%20*%20*%0A%0A%23%23%23%203%E3%80%81%E8%B7%B3%E8%BD%AC%E8%87%B3%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%0A%E4%BD%BF%E7%94%A8%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%B1%87%E7%BC%96%E6%98%AF%E4%B8%80%E4%B8%AA%E6%96%B9%E6%A1%88%EF%BC%8C%E4%BD%86%E7%81%B5%E6%B4%BB%E5%88%A9%E7%94%A8C%E8%AF%AD%E8%A8%80%E4%B8%AD%E2%80%9D%E6%8C%87%E5%90%91%E5%87%BD%E6%95%B0%E7%9A%84%E6%8C%87%E9%92%88%E2%80%9C%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%AE%80%E6%B4%81%E5%9C%B0%E5%AE%9E%E7%8E%B0%E8%B7%B3%E8%BD%AC%E3%80%82%0A%60%60%60%0A((void(*)(void))mem_address)()%3B%0A%60%60%60%0A%0A*%20*%20*%0A%23%23%23%204%E3%80%81%E4%B8%AA%E4%BA%BA%E8%A7%89%E5%BE%97%E6%9C%AC%E5%AE%9E%E9%AA%8C%E7%9A%84%E9%9A%BE%E7%82%B9%0A%E6%9C%AC%E5%AE%9E%E9%AA%8C%E6%9C%80%E9%9A%BE%E4%B9%8B%E5%A4%84%E5%9C%A8%E4%BA%8E%E6%AD%A3%E7%A1%AE%E7%90%86%E8%A7%A3%E5%90%84%E6%96%87%E4%BB%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%85%B6%E6%89%80%E5%9C%A8%E5%86%85%E5%AD%98%E4%BD%8D%E7%BD%AE%EF%BC%8C%E7%9B%B8%E4%BA%92%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E3%80%82%0A%E7%90%86%E8%A7%A3%E4%B8%8A%E8%BF%B0%E5%86%85%E5%AE%B9%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%AF%94%E8%BE%83%E7%81%B5%E6%B4%BB%E5%9C%B0%E5%AE%89%E6%8E%92%E9%9C%80%E8%A6%81%E5%AD%98%E5%82%A8%E3%80%81%E4%BC%A0%E9%80%92%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E6%8C%89%E7%85%A7%E8%87%AA%E5%B7%B1%E7%9A%84%E6%83%B3%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%9B%AE%E6%A0%87%E5%8A%9F%E8%83%BD%E3%80%82%0A%E5%90%A6%E5%88%99%E5%B0%B1%E4%BC%9A%E8%A7%89%E5%BE%97%E6%97%A0%E4%BB%8E%E4%B8%8B%E6%89%8B%EF%BC%8C%E4%B8%8D%E7%9F%A5%E9%81%93%E8%AF%A5%E5%9C%A8%E4%BD%95%E5%A4%84%E5%AE%9E%E7%8E%B0%E4%BD%95%E7%A7%8D%E5%8A%9F%E8%83%BD%E3%80%82%0A%E4%BF%97%E8%AF%9D%E8%AF%B4%E4%B8%87%E4%BA%8B%E5%BC%80%E5%A4%B4%E9%9A%BE%EF%BC%8C%E5%AE%8C%E6%88%90%E6%9C%AC%E6%AC%A1%E8%AF%95%E9%AA%8C%E5%90%8E%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%AF%B9%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%93%E6%9E%84%E5%8F%88%E6%9C%89%E4%BA%86%E4%B8%80%E4%B8%AA%E6%9B%B4%E6%B8%85%E6%99%B0%E7%9A%84%E8%AE%A4%E8%AF%86%EF%BC%88%E8%AF%A5%E8%AF%B4%E6%98%AF%E5%9B%A0%E4%B8%BA%E4%BB%A5%E5%89%8D%E5%B0%B1%E6%B2%A1%E6%9C%89%E8%AE%A4%E8%AF%86%E5%90%A7%EF%BC%9A%EF%BC%89%EF%BC%89%E3%80%82%0A%0A%20%20%20%20%20%20%20%20%0A%20%0A%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20</center></span>
</div></body></html> 